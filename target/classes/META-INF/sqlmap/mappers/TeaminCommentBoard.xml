<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.mylog.dao.TeaminCommentBoardDao">
	<resultMap type="TeaminCommentBoard" id="TeaminCommentBoardResult">
		<result column="ticnum" property="ticnum"/>
		<result column="tinum" property="tinum"/>
		<result column="tmno" property="tmno"/>
		<result column="ticcontent" property="ticcontent"/>
		<result column="ticrdate" property="ticrdate"/>
		<result column="ticgroup" property="ticgroup"/>
		<result column="ticstep" property="ticstep"/>
		<result column="ticindent" property="ticindent"/>
		<result column="ticip" property="ticip"/>
		<result column="mid" property="mid"/>
		<result column="cstartRow" property="cstartRow"/>
		<result column="cendRow" property="cendRow"/>
	</resultMap>
	
	<!-- boardList -->
	<select id="teaminCommentList" parameterType="TeaminCommentBoard" resultType="TeaminCommentBoard">
		SELECT B.*, TM.MID FROM 
	        (SELECT ROWNUM RN, A.* FROM 
	            (SELECT TiC.* FROM TEAMin_COMMENTBOARD TiC WHERE tiNUM=#{tinum}
	                        ORDER BY ticGROUP DESC, ticSTEP) A) B, TEAM_MEMBER TM
	        WHERE B.tmNO = TM.tmNO AND RN BETWEEN #{startRow} AND #{endRow}
	</select>
	<!-- totCnt -->
	<select id="teaminCommentTotCnt" resultType="int">
		SELECT COUNT(*) FROM TEAMin_COMMENTBOARD
	</select>
	<!-- write -->
	<insert id="teaminCommentWrite" parameterType="TeaminCommentBoard" >
		INSERT INTO TEAMin_COMMENTBOARD (ticNUM, tiNUM, tmNO, ticCONTENT, ticGROUP, ticSTEP, ticINDENT, ticIP)
        	VALUES (TEAMin_COMMENTBOARD_SEQ.NEXTVAL, #{tinum}, #{tmno}, #{ticcontent}, TEAMin_COMMENTBOARD_SEQ.CURRVAL, 0, 0, #{ticip})
    </insert>
	<!-- modify -->
	<update id="teaminCommentModify" parameterType="TeaminCommentBoard">
		 UPDATE TEAMin_COMMENTBOARD SET ticCONTENT = #{ticcontent},
				                         ticIP = #{ticip},
				                         ticRDATE = SYSDATE
				                WHERE ticNUM = #{ticnum}
	</update>
	<!-- delete -->
	<delete id="teaminCommentDelete" parameterType="int">
		 DELETE FROM TEAMin_COMMENTBOARD WHERE ticNUM=#{ticnum}
	</delete>
	<!-- preReply -->
	<update id="teaminCommentPreReply" parameterType="TeaminCommentBoard">
		<![CDATA[	
			UPDATE TEAMin_COMMENTBOARD SET ticSTEP = ticSTEP+1 
        		WHERE ticGROUP = #{ticgroup} AND ticSTEP>0#{ticstep}
		]]>
	</update>
	<!-- reply -->
	<insert id="teaminCommentReply" parameterType="TeaminCommentBoard">
		INSERT INTO TEAMin_COMMENTBOARD (ticNUM, tiNUM, tmNO, ticCONTENT, ticGROUP, ticSTEP, ticINDENT, ticIP)
        	VALUES (TEAMin_COMMENTBOARD_SEQ.NEXTVAL, #{tinum}, #{tmno}, #{ticcontent}, #{ticgroup}, #{ticstep}+1, #{ticindent}+1, #{ticip})
	</insert>
	
</mapper>