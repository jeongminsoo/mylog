<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="package com.project.mylog.dao.DiaryBoardDao">
	<resultMap type="DiaryBoard" id="TodoResult">
		<result property="dnum" column="dnum"/>
		<result property="dtitle" column="dtitle"/>
		<result property="mname" column="mname"/>
		<result property="dtodoin" column="dtodoin"/>
		<result property="dcontent" column="dcontent"/>
		<result property="dhit" column="dhit"/>
		<result property="dstatus" column="dstatus"/>
		<result property="ddate" column="drdate"/>
		<result property="drdate" column="drdate"/>
		<result property="dip" column="dip"/>
	</resultMap>
	
	<!-- 내 일기 리스트 -->
	<select id="myDirayList" parameterType="DiaryBoard" resultMap="TodoResult">
		SELECT * FROM DIARYBOARD 
    		WHERE DDATE = ${ddate} AND MID = #{mid}
	</select>
	
	<!-- 내가 볼 수 있는 일기 리스트 -->
	<select id="diaryList" parameterType="String" resultMap="TodoResult">
		SELECT D.*, MNAME
		    FROM DIARYBOARD D, FRIEND F, MEMBER M
		    WHERE (D.MID=M.MID AND DSTATUS = 2 AND MSTATUS=1)  OR
				    (D.MID=F.FID AND M.MID=F.FID AND DSTATUS = 1 AND F.MID=#{mid} AND MSTATUS=1) OR
				    (D.MID=M.MID AND M.MID=#{mid})
		    ORDER BY DRDATE DESC
	</select>
	
	<!-- 일기 자세히 보기 -->
	<select id="diaryContent" parameterType="int" resultType="DiaryBoard">
		SELECT D.*, MNAME 
		    FROM DIARYBOARD D, MEMBER M
		    WHERE D.MID=M.MID AND DNUM = #{dnum}
	</select>
	
	<!-- 조회수 올리기 -->
	<update id="diaryHitup" parameterType="int">
		UPDATE DIARYBOARD SET DHIT = DHIT + 1 WHERE DNUM = #{dnum}
	</update>
	
	<!-- 글 삭제하기 -->
	<delete id="diaryDelete" parameterType="int">
		DELETE FROM DIARYBOARD WHERE DNUM = #{dnum}
	</delete>
	
</mapper>